<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DiabetesCare Telemedicine Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://js.paystack.co/v1/inline.js"></script>
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        .table-container {
            overflow-x: auto;
        }
        .table-container::-webkit-scrollbar {
            display: none;
        }
        html {
            scroll-behavior: smooth;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen">

    <!-- Public Navigation -->
    <nav id="publicNav" class="bg-white border-b border-gray-200 shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="logo flex items-center gap-3">
                    <img src="./assets/images/theclinic.jpeg" alt="DiabetesCare Logo" class="w-12 h-12 object-contain rounded-lg">
                    <span class="font-bold text-xl sm:text-2xl text-blue-600">DiabetesCare</span>
                </div>
                <div class="hidden md:flex items-center gap-2">
                    <button class="px-4 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100 hover:text-blue-600 transition" onclick="showPage('landing')">Home</button>
                    <button class="px-4 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100 hover:text-blue-600 transition" onclick="showPage('register')">Register</button>
                    <button class="px-4 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100 hover:text-blue-600 transition" onclick="showPage('login')">Login</button>
                </div>
                <div class="md:hidden flex items-center">
                    <button id="publicMenuButton" class="text-gray-700 focus:outline-none">
                        <span class="text-2xl">‚ò∞</span>
                    </button>
                </div>
            </div>
            <div id="publicMobileMenu" class="md:hidden hidden bg-white border-t border-gray-200">
                <div class="px-2 pt-2 pb-3 space-y-1">
                    <button class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-100 w-full text-left transition" onclick="showPage('landing')">Home</button>
                    <button class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-100 w-full text-left transition" onclick="showPage('register')">Register</button>
                    <button class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-100 w-full text-left transition" onclick="showPage('login')">Login</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Patient Navigation -->
    <nav id="patientNav" class="bg-white border-b border-gray-200 shadow-sm sticky top-0 z-50 hidden">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="logo flex items-center gap-3">
                    <img src="./assets/images/theclinic.jpeg" alt="DiabetesCare Logo" class="w-12 h-12 object-contain rounded-lg">
                    <span class="font-bold text-xl sm:text-2xl text-blue-600">DiabetesCare</span>
                </div>
                <div class="hidden md:flex items-center gap-4">
                    <button class="px-4 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100 hover:text-blue-600 transition" onclick="showPage('patient-dashboard')">Dashboard</button>
                    <div class="notification-badge relative cursor-pointer p-2" onclick="toggleNotifications('patient')">
                        <span class="text-xl">üîî</span>
                        <span class="badge absolute top-0 right-0 bg-red-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold" id="patientNotificationCount">0</span>
                    </div>
                    <button class="bg-red-600 text-white px-6 py-3 rounded-lg text-base font-semibold hover:bg-red-700 transition shadow-md hover:shadow-lg transform hover:-translate-y-0.5" onclick="logout()">Logout</button>
                </div>
                <div class="md:hidden flex items-center">
                    <button id="patientMenuButton" class="text-gray-700 focus:outline-none">
                        <span class="text-2xl">‚ò∞</span>
                    </button>
                </div>
            </div>
            <div id="patientMobileMenu" class="md:hidden hidden bg-white border-t border-gray-200">
                <div class="px-2 pt-2 pb-3 space-y-1">
                    <button class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-100 w-full text-left transition" onclick="showPage('patient-dashboard')">Dashboard</button>
                    <button class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-100 w-full text-left transition" onclick="toggleNotifications('patient')">Notifications</button>
                    <button class="block px-3 py-3 rounded-md text-base font-semibold text-red-600 hover:bg-red-50 w-full text-left transition" onclick="logout()">Logout</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Doctor Navigation -->
    <nav id="doctorNav" class="bg-white border-b border-gray-200 shadow-sm sticky top-0 z-50 hidden">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="logo flex items-center gap-3">
                    <img src="./assets/images/theclinic.jpeg" alt="DiabetesCare Logo" class="w-12 h-12 object-contain rounded-lg">
                    <span class="font-bold text-xl sm:text-2xl text-blue-600">DiabetesCare</span>
                </div>
                <div class="hidden md:flex items-center gap-4">
                    <button class="px-4 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100 hover:text-blue-600 transition" onclick="showPage('doctor-dashboard')">Dashboard</button>
                    <div class="notification-badge relative cursor-pointer p-2" onclick="toggleNotifications('doctor')">
                        <span class="text-xl">üîî</span>
                        <span class="badge absolute top-0 right-0 bg-red-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold" id="doctorNotificationCount">0</span>
                    </div>
                    <button class="bg-red-600 text-white px-6 py-3 rounded-lg text-base font-semibold hover:bg-red-700 transition shadow-md hover:shadow-lg transform hover:-translate-y-0.5" onclick="logout()">Logout</button>
                </div>
                <div class="md:hidden flex items-center">
                    <button id="doctorMenuButton" class="text-gray-700 focus:outline-none">
                        <span class="text-2xl">‚ò∞</span>
                    </button>
                </div>
            </div>
            <div id="doctorMobileMenu" class="md:hidden hidden bg-white border-t border-gray-200">
                <div class="px-2 pt-2 pb-3 space-y-1">
                    <button class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-100 w-full text-left transition" onclick="showPage('doctor-dashboard')">Dashboard</button>
                    <button class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-100 w-full text-left transition" onclick="toggleNotifications('doctor')">Notifications</button>
                    <button class="block px-3 py-3 rounded-md text-base font-semibold text-red-600 hover:bg-red-50 w-full text-left transition" onclick="logout()">Logout</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Availability Banner -->
    <div id="availabilityBanner" class="bg-gradient-to-r from-blue-600 to-emerald-600 text-white py-3 text-center font-medium hidden overflow-hidden">
        <div class="banner-content inline-block whitespace-nowrap animate-[scroll-left_20s_linear_infinite]">
            Dr. Ahmad Ismail is available: <span id="availableDays">Monday, Wednesday, Friday, Saturday</span> | Consultation Hours: 9:00 AM - 5:00 PM
        </div>
    </div>

    <!-- Patient Notification Panel -->
    <div id="patientNotificationPanel" class="fixed right-[-400px] top-16 w-96 h-[calc(100vh-64px)] bg-white shadow-[-2px_0_8px_rgba(0,0,0,0.1)] transition-all duration-300 z-40 overflow-y-auto">
        <div class="p-5 border-b border-gray-200 bg-gray-50 flex justify-between items-center">
            <h3 class="m-0 text-lg font-semibold">Notifications</h3>
            <div class="flex gap-3">
                <button class="text-sm text-blue-600 hover:underline" onclick="clearNotifications('patient', false)">Clear Unread</button>
                <button class="text-sm text-red-600 hover:underline" onclick="clearNotifications('patient', true)">Clear All</button>
            </div>
        </div>
        <div id="patientNotificationList"></div>
    </div>

    <!-- Doctor Notification Panel -->
    <div id="doctorNotificationPanel" class="fixed right-[-400px] top-16 w-96 h-[calc(100vh-64px)] bg-white shadow-[-2px_0_8px_rgba(0,0,0,0.1)] transition-all duration-300 z-40 overflow-y-auto">
        <div class="p-5 border-b border-gray-200 bg-gray-50 flex justify-between items-center">
            <h3 class="m-0 text-lg font-semibold">Notifications</h3>
            <div class="flex gap-3">
                <button class="text-sm text-blue-600 hover:underline" onclick="clearNotifications('doctor', false)">Clear Unread</button>
                <button class="ml-2 text-sm text-red-600 hover:underline" onclick="clearNotifications('doctor', true)">Clear All</button>
            </div>
        </div>
        <div id="doctorNotificationList"></div>
    </div>

    <!-- Landing Page -->
    <div id="landing" class="page-container block">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 md:py-24">
            <div class="text-center max-w-3xl mx-auto">
                <img src="./assets/images/theclinic.jpeg" alt="Clinic Logo" class="w-28 h-28 md:w-32 md:h-32 mx-auto mb-6 rounded-xl object-contain">
                <h1 class="text-4xl sm:text-5xl font-semibold mb-5 text-gray-900">DiabetesCare Telemedicine Platform</h1>
                <p class="text-lg md:text-xl text-gray-600 mb-10 leading-relaxed">Professional diabetes consultation from the comfort of your home. Connect with Dr. Ahmad Ismail via secure video calls.</p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <button class="bg-blue-600 text-white px-8 py-3.5 rounded-lg text-lg font-medium hover:bg-blue-700 transition shadow-md hover:shadow-lg" onclick="showPage('register')">Get Started</button>
                    <button class="border border-gray-300 text-gray-700 px-8 py-3.5 rounded-lg text-lg font-medium hover:bg-gray-100 transition" onclick="showPage('login')">Sign In</button>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-16 md:mt-20">
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm text-center md:text-left">
                    <div class="text-5xl mb-4">üìπ</div>
                    <h3 class="mb-2 font-semibold text-lg">Video Consultations</h3>
                    <p class="text-sm text-gray-600">Connect with Dr. Ahmad Ismail through secure video calls</p>
                </div>
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm text-center md:text-left">
                    <div class="text-5xl mb-4">üìã</div>
                    <h3 class="mb-2 font-semibold text-lg">E-Prescriptions</h3>
                    <p class="text-sm text-gray-600">Receive digital prescriptions directly to your portal</p>
                </div>
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm text-center md:text-left">
                    <div class="text-5xl mb-4">üî¨</div>
                    <h3 class="mb-2 font-semibold text-lg">Lab Test Management</h3>
                    <p class="text-sm text-gray-600">Upload and track your test results seamlessly</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Registration Page -->
    <div id="register" class="page-container hidden">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm max-w-xl mx-auto">
                <div class="p-6 border-b border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-900">Patient Registration</h2>
                </div>
                <div class="p-6">
                    <form id="registerForm" onsubmit="handleRegister(event)">
                        <div class="mb-5">
                            <label class="block font-medium mb-2 text-gray-700">Full Name *</label>
                            <input type="text" id="regFullName" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-1 focus:ring-blue-600" required>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-5">
                            <div>
                                <label class="block font-medium mb-2 text-gray-700">Age *</label>
                                <input type="number" id="regAge" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-1 focus:ring-blue-600" required>
                            </div>
                            <div>
                                <label class="block font-medium mb-2 text-gray-700">Gender *</label>
                                <select id="regGender" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-1 focus:ring-blue-600" required>
                                    <option value="">Select Gender</option>
                                    <option>Male</option>
                                    <option>Female</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-5">
                            <label class="block font-medium mb-2 text-gray-700">Phone Number *</label>
                            <input type="tel" id="regPhone" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-1 focus:ring-blue-600" required>
                        </div>
                        <div class="mb-5">
                            <label class="block font-medium mb-2 text-gray-700">Email</label>
                            <input type="email" id="regEmail" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-1 focus:ring-blue-600">
                        </div>
                        <div class="mb-5">
                            <label class="block font-medium mb-2 text-gray-700">Username *</label>
                            <input type="text" id="regUsername" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-1 focus:ring-blue-600" required>
                        </div>
                        <div class="mb-5">
                            <label class="block font-medium mb-2 text-gray-700">Password *</label>
                            <input type="password" id="regPassword" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-1 focus:ring-blue-600" required>
                        </div>
                        <button type="submit" class="w-full bg-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-700 transition">Register</button>
                        <p class="text-center mt-5 text-sm text-gray-600">Already have an account? <a href="#" class="text-blue-600 hover:underline" onclick="showPage('login'); return false;">Sign In</a></p>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- OTP Modal -->
    <div id="otpModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-xl max-w-md w-[90%] mx-4 p-6">
            <div class="flex justify-between items-center mb-5">
                <h2 class="text-xl font-semibold">Activate Account</h2>
                <button class="text-3xl text-gray-500 hover:text-gray-700" onclick="closeOtpModal()">√ó</button>
            </div>
            <p class="mb-5 text-gray-600">A 6-digit code has been sent to your phone/email. Enter it below.</p>
            <form onsubmit="verifyOtp(event)">
                <input type="text" id="otpInput" class="w-full px-4 py-3 border border-gray-300 rounded-lg text-center text-2xl tracking-widest focus:outline-none focus:border-blue-600 mb-5" maxlength="6" required>
                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition">Verify</button>
            </form>
        </div>
    </div>

    <!-- Login Page -->
    <div id="login" class="page-container hidden">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm max-w-md mx-auto">
                <div class="p-6 border-b border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-900">Sign In</h2>
                </div>
                <div class="p-6">
                    <form id="loginForm" onsubmit="handleLogin(event)">
                        <div class="mb-5">
                            <label class="block font-medium mb-2 text-gray-700">Username</label>
                            <input type="text" id="loginUsername" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-1 focus:ring-blue-600" required>
                        </div>
                        <div class="mb-5">
                            <label class="block font-medium mb-2 text-gray-700">Password</label>
                            <input type="password" id="loginPassword" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-1 focus:ring-blue-600" required>
                        </div>
                        <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition">Sign In</button>
                    </form>
                    <p class="text-center mt-4 text-sm"><a href="#" class="text-blue-600 hover:underline" onclick="showForgotPassword()">Forgot Password?</a></p>
                    <div class="mt-6 p-4 bg-blue-50 rounded-lg text-sm">
                        <p class="font-bold mb-2">Demo Login Credentials:</p>
                        <p class="mb-1">Doctor: <code>doctor</code> / <code>doctor123</code></p>
                        <p class="mb-1">Patient 1: <code>shamsuddeen</code> / <code>pass123</code></p>
                        <p class="mb-1">Patient 2: <code>fatima</code> / <code>pass123</code></p>
                        <p>Patient 3: <code>jeneth</code> / <code>pass123</code></p>
                    </div>
                    <p class="text-center mt-5 text-sm text-gray-600">Don't have an account? <a href="#" class="text-blue-600 hover:underline" onclick="showPage('register'); return false;">Register</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgotPasswordModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-xl max-w-md w-[90%] mx-4 p-6">
            <div class="flex justify-between items-center mb-5">
                <h2 class="text-xl font-semibold">Reset Password</h2>
                <button class="text-3xl text-gray-500 hover:text-gray-700" onclick="closeForgotPassword()">√ó</button>
            </div>
            <p class="mb-5 text-gray-600">Enter your username or email. We'll send a reset code.</p>
            <form onsubmit="sendResetCode(event)">
                <input type="text" id="resetInput" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 mb-5" placeholder="Username or Email" required>
                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition">Send Code</button>
            </form>
        </div>
    </div>

    <!-- Patient Dashboard -->
    <div id="patient-dashboard" class="page-container hidden">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
            <h1 class="text-3xl font-bold mb-8">Welcome, <span id="patientName">Patient</span>!</h1>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm cursor-pointer hover:shadow-md transition" onclick="showBookingForm()">
                    <div class="text-5xl mb-4 text-center md:text-left">üìÖ</div>
                    <h3 class="font-semibold text-lg mb-1 text-center md:text-left">Book Appointment</h3>
                    <p class="text-sm text-gray-600 text-center md:text-left">Schedule a consultation</p>
                </div>
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm cursor-pointer hover:shadow-md transition" onclick="showUploadTests()">
                    <div class="text-5xl mb-4 text-center md:text-left">üì§</div>
                    <h3 class="font-semibold text-lg mb-1 text-center md:text-left">Upload Test Results</h3>
                    <p class="text-sm text-gray-600 text-center md:text-left">Submit lab results</p>
                </div>
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm cursor-pointer hover:shadow-md transition" onclick="showPaymentHistory()">
                    <div class="text-5xl mb-4 text-center md:text-left">üí≥</div>
                    <h3 class="font-semibold text-lg mb-1 text-center md:text-left">Payment History</h3>
                    <p class="text-sm text-gray-600 text-center md:text-left">View transactions</p>
                </div>
            </div>
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                <div class="p-6 border-b border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-900">My Appointments</h2>
                </div>
                <div class="p-6 table-container">
                    <table class="w-full min-w-max">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="p-4 text-left text-sm font-semibold text-gray-700 border-b">Date & Time</th>
                                <th class="p-4 text-left text-sm font-semibold text-gray-700 border-b">Doctor</th>
                                <th class="p-4 text-left text-sm font-semibold text-gray-700 border-b">Status</th>
                                <th class="p-4 text-left text-sm font-semibold text-gray-700 border-b">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="patientAppointmentsTable"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Doctor Dashboard -->
    <div id="doctor-dashboard" class="page-container hidden">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
            <h1 class="text-3xl font-bold mb-8">Doctor Dashboard - Dr. Ahmad Ismail</h1>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                    <div class="text-4xl font-bold text-blue-600 mb-1" id="todayAppointments">0</div>
                    <div class="text-sm text-gray-600">Today's Appointments</div>
                </div>
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                    <div class="text-4xl font-bold text-blue-600 mb-1" id="pendingRequests">0</div>
                    <div class="text-sm text-gray-600">Pending Requests</div>
                </div>
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                    <div class="text-4xl font-bold text-blue-600 mb-1" id="totalPatients">3</div>
                    <div class="text-sm text-gray-600">Total Patients</div>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-10">
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm cursor-pointer hover:shadow-md transition" onclick="showAvailabilitySettings()">
                    <div class="text-5xl mb-4 text-center md:text-left">‚è∞</div>
                    <h3 class="font-semibold text-lg mb-1 text-center md:text-left">Set Availability</h3>
                    <p class="text-sm text-gray-600 text-center md:text-left">Update consultation days</p>
                </div>
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm cursor-pointer hover:shadow-md transition" onclick="showCreatePatient()">
                    <div class="text-5xl mb-4 text-center md:text-left">üë§</div>
                    <h3 class="font-semibold text-lg mb-1 text-center md:text-left">Create Patient Account</h3>
                    <p class="text-sm text-gray-600 text-center md:text-left">Register new patient</p>
                </div>
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm cursor-pointer hover:shadow-md transition" onclick="showPrescriptionModule()">
                    <div class="text-5xl mb-4 text-center md:text-left">üíä</div>
                    <h3 class="font-semibold text-lg mb-1 text-center md:text-left">Write Prescription</h3>
                    <p class="text-sm text-gray-600 text-center md:text-left">Create e-prescription</p>
                </div>
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm cursor-pointer hover:shadow-md transition" onclick="showLabTestRequest()">
                    <div class="text-5xl mb-4 text-center md:text-left">üî¨</div>
                    <h3 class="font-semibold text-lg mb-1 text-center md:text-left">Request Lab Tests</h3>
                    <p class="text-sm text-gray-600 text-center md:text-left">Order tests for patients</p>
                </div>
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm cursor-pointer hover:shadow-md transition" onclick="showUserManagement()">
                    <div class="text-5xl mb-4 text-center md:text-left">üë•</div>
                    <h3 class="font-semibold text-lg mb-1 text-center md:text-left">User Management</h3>
                    <p class="text-sm text-gray-600 text-center md:text-left">Manage patients and view history</p>
                </div>
            </div>
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                <div class="p-6 border-b border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-900">Appointment Requests</h2>
                </div>
                <div class="p-6 table-container">
                    <table class="w-full min-w-max">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="p-4 text-left text-sm font-semibold text-gray-700 border-b">Patient</th>
                                <th class="p-4 text-left text-sm font-semibold text-gray-700 border-b">Date & Time</th>
                                <th class="p-4 text-left text-sm font-semibold text-gray-700 border-b">Status</th>
                                <th class="p-4 text-left text-sm font-semibold text-gray-700 border-b">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="doctorAppointmentsTable"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Book Appointment Modal -->
    <div id="bookingModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-xl max-w-xl w-[90%] mx-4 overflow-y-auto max-h-[90vh]">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h2 class="text-xl font-semibold">Book Appointment</h2>
                <button class="text-3xl text-gray-500 hover:text-gray-700" onclick="closeBookingForm()">√ó</button>
            </div>
            <div class="p-6">
                <form id="bookingForm" onsubmit="initiatePayment(event)">
                    <div class="mb-5">
                        <label class="block font-medium mb-2 text-gray-700">Preferred Date *</label>
                        <input type="date" id="appointmentDate" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-1 focus:ring-blue-600" required>
                    </div>
                    <div class="mb-5">
                        <label class="block font-medium mb-2 text-gray-700">Preferred Time *</label>
                        <select id="appointmentTime" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-1 focus:ring-blue-600" required>
                            <option value="">Select Time</option>
                            <option>9:00 AM</option>
                            <option>10:00 AM</option>
                            <option>11:00 AM</option>
                            <option>12:00 PM</option>
                            <option>2:00 PM</option>
                            <option>3:00 PM</option>
                            <option>4:00 PM</option>
                        </select>
                    </div>
                    <div class="mb-5">
                        <label class="block font-medium mb-2 text-gray-700">Reason for Visit *</label>
                        <textarea id="visitReason" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-1 focus:ring-blue-600 min-h-[120px]" required></textarea>
                    </div>
                    <div class="mb-6">
                        <label class="block font-medium text-gray-700">Consultation Fee: ‚Ç¶15,000</label>
                    </div>
                    <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition">Submit & Pay</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Upload Test Results Modal -->
    <div id="uploadTestsModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-xl max-w-xl w-[90%] mx-4 overflow-y-auto max-h-[90vh]">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h2 class="text-xl font-semibold">Upload Test Results</h2>
                <button class="text-3xl text-gray-500 hover:text-gray-700" onclick="closeUploadTests()">√ó</button>
            </div>
            <div class="p-6" id="requestedTestsList"></div>
        </div>
    </div>

    <!-- Payment History Modal -->
    <div id="paymentHistoryModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-xl max-w-xl w-[90%] mx-4 overflow-y-auto max-h-[90vh]">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h2 class="text-xl font-semibold">Payment History</h2>
                <button class="text-3xl text-gray-500 hover:text-gray-700" onclick="closePaymentHistory()">√ó</button>
            </div>
            <div class="p-6">
                <div class="table-container mb-5">
                    <table class="w-full min-w-max">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="p-4 text-left text-sm font-semibold text-gray-700 border-b">Date</th>
                                <th class="p-4 text-left text-sm font-semibold text-gray-700 border-b">Description</th>
                                <th class="p-4 text-left text-sm font-semibold text-gray-700 border-b">Amount</th>
                                <th class="p-4 text-left text-sm font-semibold text-gray-700 border-b">Status</th>
                            </tr>
                        </thead>
                        <tbody id="paymentHistoryTable"></tbody>
                    </table>
                </div>
                <div class="p-4 bg-emerald-50 rounded-lg">
                    <strong>Available Credit:</strong> <span id="availableCredit">‚Ç¶0</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Availability Settings Modal -->
    <div id="availabilityModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-xl max-w-xl w-[90%] mx-4 overflow-y-auto max-h-[90vh]">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h2 class="text-xl font-semibold">Set Availability</h2>
                <button class="text-3xl text-gray-500 hover:text-gray-700" onclick="closeAvailability()">√ó</button>
            </div>
            <div class="p-6">
                <form id="availabilityForm" onsubmit="saveAvailability(event)">
                    <p class="mb-4 text-gray-600">Select the days you are available for consultations:</p>
                    <div class="flex flex-col gap-3">
                        <label class="flex items-center gap-2"><input type="checkbox" name="day" value="Monday" checked> Monday</label>
                        <label class="flex items-center gap-2"><input type="checkbox" name="day" value="Tuesday"> Tuesday</label>
                        <label class="flex items-center gap-2"><input type="checkbox" name="day" value="Wednesday" checked> Wednesday</label>
                        <label class="flex items-center gap-2"><input type="checkbox" name="day" value="Thursday"> Thursday</label>
                        <label class="flex items-center gap-2"><input type="checkbox" name="day" value="Friday" checked> Friday</label>
                        <label class="flex items-center gap-2"><input type="checkbox" name="day" value="Saturday" checked> Saturday</label>
                        <label class="flex items-center gap-2"><input type="checkbox" name="day" value="Sunday"> Sunday</label>
                    </div>
                    <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition mt-6">Save Availability</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Create Patient Modal -->
    <div id="createPatientModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-xl max-w-xl w-[90%] mx-4 overflow-y-auto max-h-[90vh]">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h2 class="text-xl font-semibold">Create Patient Account</h2>
                <button class="text-3xl text-gray-500 hover:text-gray-700" onclick="closeCreatePatient()">√ó</button>
            </div>
            <div class="p-6">
                <form id="createPatientForm" onsubmit="createPatient(event)">
                    <div class="mb-5">
                        <label class="block font-medium mb-2 text-gray-700">Full Name *</label>
                        <input type="text" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-1 focus:ring-blue-600" required>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-5">
                        <div>
                            <label class="block font-medium mb-2 text-gray-700">Age *</label>
                            <input type="number" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-1 focus:ring-blue-600" required>
                        </div>
                        <div>
                            <label class="block font-medium mb-2 text-gray-700">Gender *</label>
                            <select class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-1 focus:ring-blue-600" required>
                                <option value="">Select</option>
                                <option>Male</option>
                                <option>Female</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-5">
                        <label class="block font-medium mb-2 text-gray-700">Phone *</label>
                        <input type="tel" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-1 focus:ring-blue-600" required>
                    </div>
                    <div class="mb-5">
                        <label class="block font-medium mb-2 text-gray-700">Username *</label>
                        <input type="text" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-1 focus:ring-blue-600" required>
                    </div>
                    <div class="mb-5">
                        <label class="block font-medium mb-2 text-gray-700">Password *</label>
                        <input type="password" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-1 focus:ring-blue-600" required>
                    </div>
                    <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition">Create Account</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Prescription Modal -->
    <div id="prescriptionModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-xl max-w-xl w-[90%] mx-4 overflow-y-auto max-h-[90vh]">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h2 class="text-xl font-semibold">Write Prescription</h2>
                <button class="text-3xl text-gray-500 hover:text-gray-700" onclick="closePrescription()">√ó</button>
            </div>
            <div class="p-6">
                <div class="mb-5">
                    <label class="block font-medium mb-2 text-gray-700">Select Patient *</label>
                    <select id="prescriptionPatient" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-1 focus:ring-blue-600" onchange="loadPatientForPrescription()" required>
                        <option value="">Choose Patient</option>
                    </select>
                </div>
                <div id="prescriptionFormArea" class="hidden">
                    <form id="prescriptionForm" onsubmit="savePrescription(event)">
                        <div class="mb-5">
                            <label class="block font-medium mb-2 text-gray-700">Diagnosis *</label>
                            <textarea class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-1 focus:ring-blue-600 min-h-[120px]" required></textarea>
                        </div>
                        <div class="mb-5">
                            <label class="block font-medium mb-2 text-gray-700">Medications *</label>
                            <textarea class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-1 focus:ring-blue-600 min-h-[120px]" placeholder="List medications with dosage" required></textarea>
                        </div>
                        <div class="mb-5">
                            <label class="block font-medium mb-2 text-gray-700">Instructions</label>
                            <textarea class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-1 focus:ring-blue-600 min-h-[120px]"></textarea>
                        </div>
                        <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition">Create Prescription</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Lab Test Request Modal -->
    <div id="labTestModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-xl max-w-xl w-[90%] mx-4 overflow-y-auto max-h-[90vh]">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h2 class="text-xl font-semibold">Request Lab Tests</h2>
                <button class="text-3xl text-gray-500 hover:text-gray-700" onclick="closeLabTest()">√ó</button>
            </div>
            <div class="p-6">
                <div class="mb-5">
                    <label class="block font-medium mb-2 text-gray-700">Select Patient *</label>
                    <select id="labTestPatient" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-1 focus:ring-blue-600" onchange="loadPatientForLabTest()" required>
                        <option value="">Choose Patient</option>
                    </select>
                </div>
                <div id="labTestFormArea" class="hidden">
                    <form id="labTestForm" onsubmit="saveLabTest(event)">
                        <div class="mb-5">
                            <label class="block font-medium mb-2 text-gray-700">Select Tests *</label>
                            <div class="flex flex-col gap-2">
                                <label><input type="checkbox" name="test" value="Fasting Blood Glucose"> Fasting Blood Glucose</label>
                                <label><input type="checkbox" name="test" value="HbA1c"> HbA1c</label>
                                <label><input type="checkbox" name="test" value="Lipid Profile"> Lipid Profile</label>
                                <label><input type="checkbox" name="test" value="Kidney Function"> Kidney Function</label>
                                <label><input type="checkbox" name="test" value="Liver Function"> Liver Function</label>
                                <label><input type="checkbox" name="test" value="Urine Analysis"> Urine Analysis</label>
                            </div>
                        </div>
                        <div class="mb-5">
                            <label class="block font-medium mb-2 text-gray-700">Additional Notes</label>
                            <textarea class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-1 focus:ring-blue-600 min-h-[120px]"></textarea>
                        </div>
                        <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition">Send Test Request</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- User Management Modal -->
    <div id="userManagementModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-xl max-w-4xl w-[90%] mx-4 overflow-y-auto max-h-[90vh]">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h2 class="text-xl font-semibold">User Management</h2>
                <button class="text-3xl text-gray-500 hover:text-gray-700" onclick="closeUserManagement()">√ó</button>
            </div>
            <div class="p-6">
                <div class="table-container">
                    <table class="w-full min-w-max">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="p-4 text-left text-sm font-semibold text-gray-700 border-b">Patient Name</th>
                                <th class="p-4 text-left text-sm font-semibold text-gray-700 border-b">Username</th>
                                <th class="p-4 text-left text-sm font-semibold text-gray-700 border-b">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="userListTable"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Prescription History Modal -->
    <div id="prescriptionHistoryModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-xl max-w-xl w-[90%] mx-4 overflow-y-auto max-h-[90vh]">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h2 class="text-xl font-semibold">Prescription History for <span id="historyPatientName"></span></h2>
                <button class="text-3xl text-gray-500 hover:text-gray-700" onclick="closePrescriptionHistory()">√ó</button>
            </div>
            <div class="p-6" id="prescriptionHistoryList"></div>
        </div>
    </div>

    <script>
        // Global State
        let currentUser = null;
        let currentUserType = null;
        let appointments = [];
        let patientNotifications = [];
        let doctorNotifications = [];
        let patientCredits = {};
        let labTestRequests = {};
        let availableDays = ['Monday', 'Wednesday', 'Friday', 'Saturday'];
        let patients = [
            { username: 'shamsuddeen', name: 'Shamsuddeen Usman', password: 'pass123', email: '', phone: '', age: '', gender: '', prescriptions: [] },
            { username: 'fatima', name: 'Fatima Ismail', password: 'pass123', email: '', phone: '', age: '', gender: '', prescriptions: [] },
            { username: 'jeneth', name: 'Jeneth Danjummai', password: 'pass123', email: '', phone: '', age: '', gender: '', prescriptions: [] }
        ];
        let otpCode = null;

        const paystackPublicKey = 'pk_test_xxxxxxxxxx'; // Replace with real test key if you want payment popup to actually work

        // DOM Ready
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('publicMenuButton')?.addEventListener('click', () => document.getElementById('publicMobileMenu').classList.toggle('hidden'));
            document.getElementById('patientMenuButton')?.addEventListener('click', () => document.getElementById('patientMobileMenu').classList.toggle('hidden'));
            document.getElementById('doctorMenuButton')?.addEventListener('click', () => document.getElementById('doctorMobileMenu').classList.toggle('hidden'));

            document.querySelectorAll('#publicMobileMenu button, #patientMobileMenu button, #doctorMobileMenu button')
                .forEach(btn => btn.addEventListener('click', () => {
                    document.getElementById('publicMobileMenu')?.classList.add('hidden');
                    document.getElementById('patientMobileMenu')?.classList.add('hidden');
                    document.getElementById('doctorMobileMenu')?.classList.add('hidden');
                }));

            document.addEventListener('click', e => {
                const patientPanel = document.getElementById('patientNotificationPanel');
                const doctorPanel = document.getElementById('doctorNotificationPanel');

                const insidePatient = patientPanel?.contains(e.target) || document.querySelector('[onclick*="toggleNotifications(\'patient\'")]')?.contains(e.target);
                const insideDoctor  = doctorPanel?.contains(e.target)  || document.querySelector('[onclick*="toggleNotifications(\'doctor\'")]')?.contains(e.target);

                if (!insidePatient && patientPanel?.classList.contains('right-0')) closeNotificationPanel('patient');
                if (!insideDoctor  && doctorPanel?.classList.contains('right-0'))  closeNotificationPanel('doctor');

                if (e.target.classList.contains('fixed') && e.target.classList.contains('inset-0')) {
                    e.target.classList.add('hidden');
                }
            });

            const dateInput = document.getElementById('appointmentDate');
            if (dateInput) dateInput.min = new Date().toISOString().split('T')[0];
        });

        function showPage(pageId) {
            document.querySelectorAll('.page-container').forEach(p => p.classList.add('hidden'));
            document.getElementById(pageId)?.classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function toggleMobileMenu(type) {
            document.getElementById(`${type}MobileMenu`)?.classList.toggle('hidden');
        }

        function toggleNotifications(type) {
            const panel = document.getElementById(`${type}NotificationPanel`);
            const isOpen = panel.classList.contains('right-0');
            closeNotificationPanel('patient');
            closeNotificationPanel('doctor');
            if (!isOpen) {
                panel.classList.remove('right-[-400px]');
                panel.classList.add('right-0');
                displayNotifications(type);
            }
        }

        function closeNotificationPanel(type) {
            const panel = document.getElementById(`${type}NotificationPanel`);
            panel?.classList.remove('right-0');
            panel?.classList.add('right-[-400px]');
        }

        function clearNotifications(type, all = false) {
            if (all && !confirm('Clear ALL notifications?')) return;
            if (!all && !confirm('Clear unread notifications?')) return;

            if (type === 'patient') patientNotifications = all ? [] : patientNotifications.filter(n => n.read);
            else doctorNotifications = all ? [] : doctorNotifications.filter(n => n.read);

            updateNotificationBadge(type);
            displayNotifications(type);
            closeNotificationPanel(type);
        }

        function displayNotifications(type) {
            const list = document.getElementById(`${type}NotificationList`);
            const notifs = type === 'patient' ? patientNotifications : doctorNotifications;
            list.innerHTML = notifs.length === 0
                ? '<p class="p-8 text-center text-gray-500">No notifications yet</p>'
                : notifs.map(n => `
                    <div class="p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 ${n.read ? '' : 'bg-blue-50'}" onclick="markAsRead('${type}', ${n.id})">
                        <p class="font-medium">${n.message}</p>
                        <p class="text-xs text-gray-500 mt-1">${n.time}</p>
                    </div>
                `).join('');
        }

        function markAsRead(type, id) {
            const notifs = type === 'patient' ? patientNotifications : doctorNotifications;
            const n = notifs.find(x => x.id === id);
            if (n) n.read = true;
            updateNotificationBadge(type);
            displayNotifications(type);
        }

        function updateNotificationBadge(type) {
            const notifs = type === 'patient' ? patientNotifications : doctorNotifications;
            document.getElementById(`${type}NotificationCount`).textContent = notifs.filter(n => !n.read).length;
        }

        function addNotification(type, message) {
            const notifs = type === 'patient' ? patientNotifications : doctorNotifications;
            notifs.unshift({
                id: Date.now(),
                message,
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                read: false
            });
            updateNotificationBadge(type);
        }

        function handleRegister(e) {
            e.preventDefault();
            const fullName = document.getElementById('regFullName').value.trim();
            const age      = document.getElementById('regAge').value;
            const gender   = document.getElementById('regGender').value;
            const phone    = document.getElementById('regPhone').value.trim();
            const email    = document.getElementById('regEmail').value.trim();
            const username = document.getElementById('regUsername').value.trim().toLowerCase();
            const password = document.getElementById('regPassword').value;

            if (patients.some(p => p.username === username)) {
                alert('Username already taken.');
                return;
            }

            patients.push({ username, name: fullName, password, email, phone, age, gender, prescriptions: [] });

            otpCode = String(Math.floor(100000 + Math.random() * 900000));
            alert(`[DEMO] OTP sent: ${otpCode}\n\nEnter this code to activate`);
            document.getElementById('otpModal').classList.remove('hidden');
        }

        function closeOtpModal() {
            document.getElementById('otpModal').classList.add('hidden');
        }

        function verifyOtp(e) {
            e.preventDefault();
            const code = document.getElementById('otpInput').value.trim();
            if (code === otpCode) {
                alert('Account activated! You can now log in.');
                closeOtpModal();
                showPage('login');
            } else {
                alert('Incorrect code.');
            }
        }

        function showForgotPassword() {
            document.getElementById('forgotPasswordModal').classList.remove('hidden');
        }

        function closeForgotPassword() {
            document.getElementById('forgotPasswordModal').classList.add('hidden');
        }

        function sendResetCode(e) {
            e.preventDefault();
            otpCode = String(Math.floor(100000 + Math.random() * 900000));
            alert(`[DEMO] Reset code: ${otpCode}\n\nUse this in the OTP field`);
            closeForgotPassword();
            document.getElementById('otpModal').classList.remove('hidden');
        }

        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value.trim().toLowerCase();
            const password = document.getElementById('loginPassword').value;

            if (username === 'doctor' && password === 'doctor123') {
                currentUser = 'Dr. Ahmad Ismail';
                currentUserType = 'doctor';
                document.getElementById('publicNav').classList.add('hidden');
                document.getElementById('doctorNav').classList.remove('hidden');
                showPage('doctor-dashboard');
                updateDoctorDashboard();
                return;
            }

            const patient = patients.find(p => p.username === username && p.password === password);
            if (patient) {
                currentUser = patient.name;
                currentUserType = 'patient';
                document.getElementById('publicNav').classList.add('hidden');
                document.getElementById('patientNav').classList.remove('hidden');
                document.getElementById('availabilityBanner').classList.remove('hidden');
                document.getElementById('patientName').textContent = patient.name;
                showPage('patient-dashboard');
                updatePatientDashboard();
                return;
            }

            alert('Invalid credentials.\nCheck demo logins.');
        }

        function logout() {
            if (!confirm('Log out now?')) return;
            currentUser = currentUserType = null;
            document.getElementById('publicNav').classList.remove('hidden');
            document.getElementById('patientNav').classList.add('hidden');
            document.getElementById('doctorNav').classList.add('hidden');
            document.getElementById('availabilityBanner').classList.add('hidden');
            showPage('landing');
        }

        function initiatePayment(e) {
            e.preventDefault();
            const date = document.getElementById('appointmentDate').value;
            const time = document.getElementById('appointmentTime').value;
            const reason = document.getElementById('visitReason').value;

            const patient = patients.find(p => p.name === currentUser);
            const email = patient?.email || 'info@theclinic.com.ng';
            const phone = patient?.phone || '';

            const handler = PaystackPop.setup({
                key: paystackPublicKey,
                email: email,
                amount: 1500000,
                currency: 'NGN',
                ref: '' + Math.floor((Math.random() * 1000000000) + 1),
                metadata: {
                    custom_fields: [
                        { display_name: "Mobile Number", variable_name: "mobile_number", value: phone },
                        { display_name: "Patient Name", variable_name: "patient_name", value: currentUser }
                    ]
                },
                callback: response => {
                    if (response.status === 'success') {
                        const apt = { id: Date.now(), patient: currentUser, date, time, reason, status: 'Pending', amount: 15000 };
                        appointments.push(apt);
                        addNotification('patient', `New appointment booked for ${date} at ${time}`);
                        addNotification('doctor', `New appointment request from ${currentUser} for ${date} at ${time}`);
                        alert('Payment successful! Appointment booked.');
                        closeBookingForm();
                        updatePatientDashboard();
                        document.getElementById('bookingForm').reset();
                    } else {
                        alert('Payment failed.');
                    }
                },
                onClose: () => alert('Payment window closed.')
            });
            handler.openIframe();
        }

        function showBookingForm() {
            document.getElementById('bookingModal').classList.remove('hidden');
        }

        function closeBookingForm() {
            document.getElementById('bookingModal').classList.add('hidden');
        }

        function showUploadTests() {
            const modal = document.getElementById('uploadTestsModal');
            const container = document.getElementById('requestedTestsList');
            const requested = labTestRequests[currentUser] || [];
            container.innerHTML = requested.length === 0
                ? '<p class="text-gray-600 text-center py-8">No test requests from doctor yet.</p>'
                : `
                    <p class="font-medium mb-4">Upload results for the following tests:</p>
                    ${requested.map(test => `
                        <div class="bg-white rounded-lg border border-gray-200 mb-4 p-4">
                            <h4 class="mb-3 font-medium">${test}</h4>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-10 text-center cursor-pointer hover:border-blue-600 hover:bg-gray-50 transition" onclick="this.querySelector('input').click()">
                                <input type="file" accept=".pdf,.jpg,.png" class="hidden" onchange="uploadTestResult('${test}', this.files[0])">
                                <p class="text-gray-700">Click to upload or drag file here</p>
                                <p class="text-xs text-gray-500 mt-1">PDF, JPG, PNG (Max 10MB)</p>
                            </div>
                        </div>
                    `).join('')}
                `;
            modal.classList.remove('hidden');
        }

        function closeUploadTests() {
            document.getElementById('uploadTestsModal').classList.add('hidden');
        }

        function uploadTestResult(testName, file) {
            if (!file) return;
            alert(`Uploaded: ${file.name}\n\nTest: ${testName}`);
            addNotification('patient', `Test result uploaded: ${testName}`);
            addNotification('doctor', `${currentUser} uploaded result for ${testName}`);
        }

        function showPaymentHistory() {
            const modal = document.getElementById('paymentHistoryModal');
            const tbody = document.getElementById('paymentHistoryTable');
            const userAppts = appointments.filter(a => a.patient === currentUser);
            let totalCredit = patientCredits[currentUser] || 0;

            tbody.innerHTML = userAppts.length === 0
                ? '<tr><td colspan="4" class="p-8 text-center text-gray-500">No payment history</td></tr>'
                : userAppts.map(a => `
                    <tr class="hover:bg-gray-50">
                        <td class="p-4 border-b">${a.date}</td>
                        <td class="p-4 border-b">Consultation Fee</td>
                        <td class="p-4 border-b">‚Ç¶${a.amount.toLocaleString()}</td>
                        <td class="p-4 border-b">
                            <span class="inline-block px-3 py-1 rounded-full text-xs font-medium ${a.status === 'Cancelled' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800'}">
                                ${a.status === 'Cancelled' ? 'Credited' : 'Paid'}
                            </span>
                        </td>
                    </tr>
                `).join('');

            document.getElementById('availableCredit').textContent = `‚Ç¶${totalCredit.toLocaleString()}`;
            modal.classList.remove('hidden');
        }

        function closePaymentHistory() {
            document.getElementById('paymentHistoryModal').classList.add('hidden');
        }

        function cancelAppointment(id) {
            if (!confirm('Cancel appointment? Fee will be credited.')) return;
            const apt = appointments.find(a => a.id === id);
            if (apt) {
                apt.status = 'Cancelled';
                patientCredits[currentUser] = (patientCredits[currentUser] || 0) + apt.amount;
                addNotification('patient', `Cancelled. ‚Ç¶${apt.amount.toLocaleString()} credited.`);
                addNotification('doctor', `${currentUser} cancelled appointment on ${apt.date}`);
                updatePatientDashboard();
            }
        }

        function rescheduleAppointment(id) {
            const date = prompt('New date (YYYY-MM-DD):');
            const time = prompt('New time (e.g. 10:00 AM):');
            if (!date || !time) return;
            const apt = appointments.find(a => a.id === id);
            if (apt) {
                apt.date = date;
                apt.time = time;
                apt.status = 'Rescheduled';
                addNotification('patient', `Rescheduled to ${date} at ${time}`);
                addNotification('doctor', `${currentUser} rescheduled to ${date} at ${time}`);
                updatePatientDashboard();
            }
        }

        function joinCall() {
            alert('Joining video consultation... (demo mode)');
        }

        function updatePatientDashboard() {
            const tbody = document.getElementById('patientAppointmentsTable');
            const appts = appointments.filter(a => a.patient === currentUser);
            tbody.innerHTML = appts.length === 0
                ? '<tr><td colspan="4" class="p-8 text-center text-gray-500">No appointments yet</td></tr>'
                : appts.map(a => {
                    let badge = '', actions = '';
                    if (a.status === 'Pending') {
                        badge = 'bg-yellow-100 text-yellow-800';
                        actions = `
                            <button class="text-sm text-blue-600 hover:underline mr-3" onclick="rescheduleAppointment(${a.id})">Reschedule</button>
                            <button class="text-sm text-red-600 hover:underline" onclick="cancelAppointment(${a.id})">Cancel</button>
                        `;
                    } else if (a.status === 'Confirmed') {
                        badge = 'bg-green-100 text-green-800';
                        actions = `
                            <button class="text-sm text-blue-600 hover:underline mr-3" onclick="joinCall()">Join Call</button>
                            <button class="text-sm text-gray-600 hover:underline" onclick="rescheduleAppointment(${a.id})">Reschedule</button>
                        `;
                    } else if (a.status === 'Completed') {
                        badge = 'bg-blue-100 text-blue-800';
                        actions = '‚Äî';
                    } else if (a.status === 'Cancelled') {
                        badge = 'bg-red-100 text-red-800';
                        actions = 'Credited';
                    } else if (a.status === 'Rescheduled') {
                        badge = 'bg-yellow-100 text-yellow-800';
                        actions = `<button class="text-sm text-red-600 hover:underline" onclick="cancelAppointment(${a.id})">Cancel</button>`;
                    }
                    return `
                        <tr class="hover:bg-gray-50">
                            <td class="p-4 border-b">${a.date} ${a.time}</td>
                            <td class="p-4 border-b">Dr. Ahmad Ismail</td>
                            <td class="p-4 border-b"><span class="px-3 py-1 rounded-full text-xs font-medium ${badge}">${a.status}</span></td>
                            <td class="p-4 border-b">${actions}</td>
                        </tr>
                    `;
                }).join('');
        }

        function updateDoctorDashboard() {
            const tbody = document.getElementById('doctorAppointmentsTable');
            tbody.innerHTML = appointments.length === 0
                ? '<tr><td colspan="4" class="p-8 text-center text-gray-500">No appointment requests</td></tr>'
                : appointments.map(a => {
                    let badge = '', actions = '';
                    if (a.status === 'Pending') {
                        badge = 'bg-yellow-100 text-yellow-800';
                        actions = `
                            <button class="text-sm text-blue-600 hover:underline mr-3" onclick="confirmAppointment(${a.id})">Confirm</button>
                            <button class="text-sm text-red-600 hover:underline" onclick="rejectAppointment(${a.id})">Reject</button>
                        `;
                    } else if (a.status === 'Confirmed') {
                        badge = 'bg-green-100 text-green-800';
                        actions = `<button class="text-sm text-blue-600 hover:underline" onclick="startCall(${a.id})">Start Call</button>`;
                    } else if (a.status === 'Completed') {
                        badge = 'bg-blue-100 text-blue-800';
                        actions = '‚Äî';
                    } else {
                        badge = 'bg-red-100 text-red-800';
                        actions = '‚Äî';
                    }
                    return `
                        <tr class="hover:bg-gray-50">
                            <td class="p-4 border-b">${a.patient}</td>
                            <td class="p-4 border-b">${a.date} ${a.time}</td>
                            <td class="p-4 border-b"><span class="px-3 py-1 rounded-full text-xs font-medium ${badge}">${a.status}</span></td>
                            <td class="p-4 border-b">${actions}</td>
                        </tr>
                    `;
                }).join('');

            const today = new Date().toISOString().split('T')[0];
            document.getElementById('todayAppointments').textContent = appointments.filter(a => a.date === today && a.status !== 'Cancelled').length;
            document.getElementById('pendingRequests').textContent = appointments.filter(a => a.status === 'Pending').length;
            document.getElementById('totalPatients').textContent = patients.length;
        }

        function confirmAppointment(id) {
            const a = appointments.find(x => x.id === id);
            if (a) {
                a.status = 'Confirmed';
                addNotification('patient', `Appointment confirmed for ${a.date} at ${a.time}`);
                addNotification('doctor', `Confirmed appointment for ${a.patient}`);
                updateDoctorDashboard();
            }
        }

        function rejectAppointment(id) {
            if (!confirm('Reject this request?')) return;
            const a = appointments.find(x => x.id === id);
            if (a) {
                a.status = 'Rejected';
                addNotification('patient', `Appointment rejected for ${a.date} at ${a.time}`);
                addNotification('doctor', `Rejected appointment for ${a.patient}`);
                updateDoctorDashboard();
            }
        }

        function startCall() {
            alert('Starting video call... (demo)');
        }

        function showAvailabilitySettings() {
            document.getElementById('availabilityModal').classList.remove('hidden');
        }

        function closeAvailability() {
            document.getElementById('availabilityModal').classList.add('hidden');
        }

        function saveAvailability(e) {
            e.preventDefault();
            availableDays = Array.from(document.querySelectorAll('#availabilityModal input[name="day"]:checked')).map(cb => cb.value);
            if (availableDays.length === 0) return alert('Select at least one day');
            document.getElementById('availableDays').textContent = availableDays.join(', ');
            addNotification('doctor', 'Availability updated');
            closeAvailability();
        }

        function showCreatePatient() {
            document.getElementById('createPatientModal').classList.remove('hidden');
        }

        function closeCreatePatient() {
            document.getElementById('createPatientModal').classList.add('hidden');
        }

        function createPatient(e) {
            e.preventDefault();
            const f = e.target;
            const p = {
                name: f[0].value.trim(),
                age: f[1].value,
                gender: f[2].value,
                phone: f[3].value.trim(),
                username: f[4].value.trim().toLowerCase(),
                password: f[5].value,
                email: '',
                prescriptions: []
            };
            patients.push(p);
            addNotification('doctor', `New patient: ${p.name}`);
            alert('Patient account created');
            closeCreatePatient();
            f.reset();
            updateDoctorDashboard();
        }

        function showPrescriptionModule() {
            const sel = document.getElementById('prescriptionPatient');
            sel.innerHTML = '<option value="">Choose Patient</option>' + patients.map(p => `<option value="${p.name}">${p.name}</option>`).join('');
            document.getElementById('prescriptionModal').classList.remove('hidden');
        }

        function closePrescription() {
            document.getElementById('prescriptionModal').classList.add('hidden');
            document.getElementById('prescriptionFormArea').classList.add('hidden');
        }

        function loadPatientForPrescription() {
            document.getElementById('prescriptionFormArea').classList.toggle('hidden', !document.getElementById('prescriptionPatient').value);
        }

        function savePrescription(e) {
            e.preventDefault();
            const f = e.target;
            const name = document.getElementById('prescriptionPatient').value;
            const pat = patients.find(p => p.name === name);
            if (!pat) return;
            pat.prescriptions.push({
                diagnosis: f[0].value.trim(),
                medications: f[1].value.trim(),
                instructions: f[2].value.trim(),
                date: new Date().toISOString().split('T')[0]
            });
            addNotification('patient', 'New prescription received');
            addNotification('doctor', `Prescription saved for ${name}`);
            alert('Prescription created');
            closePrescription();
            f.reset();
        }

        function showLabTestRequest() {
            const sel = document.getElementById('labTestPatient');
            sel.innerHTML = '<option value="">Choose Patient</option>' + patients.map(p => `<option value="${p.name}">${p.name}</option>`).join('');
            document.getElementById('labTestModal').classList.remove('hidden');
        }

        function closeLabTest() {
            document.getElementById('labTestModal').classList.add('hidden');
            document.getElementById('labTestFormArea').classList.add('hidden');
        }

        function loadPatientForLabTest() {
            document.getElementById('labTestFormArea').classList.toggle('hidden', !document.getElementById('labTestPatient').value);
        }

        function saveLabTest(e) {
            e.preventDefault();
            const name = document.getElementById('labTestPatient').value;
            const tests = Array.from(document.querySelectorAll('#labTestModal input[name="test"]:checked')).map(cb => cb.value);
            if (tests.length === 0) return alert('Select at least one test');
            if (!labTestRequests[name]) labTestRequests[name] = [];
            labTestRequests[name].push(...tests);
            addNotification('patient', 'New lab test request received');
            addNotification('doctor', `Tests requested for ${name}`);
            alert('Test request sent');
            closeLabTest();
            e.target.reset();
        }

        function showUserManagement() {
            const tbody = document.getElementById('userListTable');
            tbody.innerHTML = patients.map(p => `
                <tr class="hover:bg-gray-50">
                    <td class="p-4 border-b">${p.name}</td>
                    <td class="p-4 border-b">${p.username}</td>
                    <td class="p-4 border-b">
                        <button class="text-sm text-blue-600 hover:underline mr-4" onclick="viewPrescriptionHistory('${p.name}')">View Prescriptions</button>
                        <button class="text-sm text-red-600 hover:underline" onclick="deletePatient('${p.username}')">Delete</button>
                    </td>
                </tr>
            `).join('');
            document.getElementById('userManagementModal').classList.remove('hidden');
        }

        function closeUserManagement() {
            document.getElementById('userManagementModal').classList.add('hidden');
        }

        function deletePatient(username) {
            if (!confirm('Delete this patient permanently?')) return;
            patients = patients.filter(p => p.username !== username);
            addNotification('doctor', `Patient ${username} deleted`);
            showUserManagement();
            updateDoctorDashboard();
        }

        function viewPrescriptionHistory(name) {
            const modal = document.getElementById('prescriptionHistoryModal');
            document.getElementById('historyPatientName').textContent = name;
            const pat = patients.find(p => p.name === name);
            const container = document.getElementById('prescriptionHistoryList');
            container.innerHTML = !pat || pat.prescriptions.length === 0
                ? '<p class="text-gray-600 text-center py-8">No prescriptions yet</p>'
                : pat.prescriptions.map((pr, i) => `
                    <div class="bg-gray-50 rounded-lg p-5 mb-4 border border-gray-200">
                        <h4 class="font-medium mb-3">Prescription #${i+1} ‚Äì ${pr.date}</h4>
                        <p class="mb-2"><strong>Diagnosis:</strong> ${pr.diagnosis}</p>
                        <p class="mb-2"><strong>Medications:</strong> ${pr.medications}</p>
                        <p><strong>Instructions:</strong> ${pr.instructions || 'None'}</p>
                    </div>
                `).join('');
            modal.classList.remove('hidden');
        }

        function closePrescriptionHistory() {
            document.getElementById('prescriptionHistoryModal').classList.add('hidden');
        }
    </script>
</body>
</html>
